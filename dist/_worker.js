var Ie=Object.defineProperty;var he=e=>{throw TypeError(e)};var Le=(e,t,r)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>Le(e,typeof t!="symbol"?t+"":t,r),le=(e,t,r)=>t.has(e)||he("Cannot "+r);var h=(e,t,r)=>(le(e,t,"read from private field"),r?r.call(e):t.get(e)),b=(e,t,r)=>t.has(e)?he("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),p=(e,t,r,s)=>(le(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);import{jsxs as ue,jsx as _}from"react/jsx-runtime";import{renderToString as _e}from"react-dom/server";var Ce=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof Ee?e.raw.headers:e.headers).get("Content-Type");return i!==null&&i.startsWith("multipart/form-data")||i!==null&&i.startsWith("application/x-www-form-urlencoded")?Te(e,{all:r,dot:s}):{}};async function Te(e,t){const r=await e.formData();return r?Ne(r,t):{}}function Ne(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Me(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Be(r,s,n),delete r[s])}),r}var Me=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},Be=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},ye=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ke=e=>{const{groups:t,path:r}=Ue(e),s=ye(r);return We(s,t)},Ue=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},We=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},J={},de=e=>{if(e==="*")return"*";const t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(J[e]||(t[2]?J[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:J[e]=[e,t[1],!0]),J[e]):null},Ve=e=>{try{return decodeURI(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return decodeURI(t)}catch{return t}})}},be=e=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return Ve(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)},qe=e=>{const t=be(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},k=(...e)=>{let t="",r=!1;for(let s of e)t[t.length-1]==="/"&&(t=t.slice(0,-1),r=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&r?t=`${t}/`:s!=="/"&&(t=`${t}${s}`),s==="/"&&t===""&&(t="/");return t},ve=e=>{if(!e.match(/\:.+\?$/))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},se=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),/%/.test(e)?ie(e):e):e,xe=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const c=e.charCodeAt(a+t.length+1);if(c===61){const o=a+t.length+2,l=e.indexOf("&",o);return se(e.slice(o,l===-1?void 0:l))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let c=e.indexOf("=",i);c>a&&a!==-1&&(c=-1);let o=e.slice(i+1,c===-1?a===-1?void 0:a:c);if(s&&(o=se(o)),i=a,o==="")continue;let l;c===-1?l="":(l=e.slice(c+1,a===-1?void 0:a),s&&(l=se(l))),r?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(l)):n[o]??(n[o]=l)}return t?n[t]:n},Ke=xe,ze=(e,t)=>xe(e,t,!0),ie=decodeURIComponent,T,E,me,Ee=(me=class{constructor(e,t="/",r=[[]]){d(this,"raw");b(this,T);b(this,E);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});d(this,"cachedBody",e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,p(this,E,r),p(this,T,{})}param(e){return e?this.getDecodedParam(e):this.getAllDecodedParams()}getDecodedParam(e){const t=h(this,E)[0][this.routeIndex][1][e],r=this.getParamValue(t);return r?/\%/.test(r)?ie(r):r:void 0}getAllDecodedParams(){const e={},t=Object.keys(h(this,E)[0][this.routeIndex][1]);for(const r of t){const s=this.getParamValue(h(this,E)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?ie(s):s)}return e}getParamValue(e){return h(this,E)[1]?h(this,E)[1][e]:e}query(e){return Ke(this.url,e)}queries(e){return ze(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Ce(this,e))}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(e,t){h(this,T)[e]=t}valid(e){return h(this,T)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return h(this,E)[0].map(([[,e]])=>e)}get routePath(){return h(this,E)[0].map(([[,e]])=>e)[this.routeIndex].path}},T=new WeakMap,E=new WeakMap,me),Ge={Stringify:1,BeforeStream:2,Stream:3},Oe=async(e,t,r,s,n)=>{const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(c=>c({phase:t,buffer:n,context:s}))).then(c=>Promise.all(c.filter(Boolean).map(o=>Oe(o,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},Xe="text/plain; charset=UTF-8",ne=(e,t={})=>(Object.entries(t).forEach(([r,s])=>e.set(r,s)),e),q,K,D,I,A,g,w,O,$,z,N,M,G,X,we,Z=(we=class{constructor(e,t){b(this,q);b(this,K);d(this,"env",{});b(this,D);d(this,"finalized",!1);d(this,"error");b(this,I,200);b(this,A);b(this,g);b(this,w);b(this,O);b(this,$,!0);b(this,z);b(this,N);b(this,M);b(this,G);b(this,X);d(this,"render",(...e)=>(h(this,N)??p(this,N,t=>this.html(t)),h(this,N).call(this,...e)));d(this,"setLayout",e=>p(this,z,e));d(this,"getLayout",()=>h(this,z));d(this,"setRenderer",e=>{p(this,N,e)});d(this,"header",(e,t,r)=>{if(t===void 0){h(this,g)?h(this,g).delete(e):h(this,w)&&delete h(this,w)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r!=null&&r.append?(h(this,g)||(p(this,$,!1),p(this,g,new Headers(h(this,w))),p(this,w,{})),h(this,g).append(e,t)):h(this,g)?h(this,g).set(e,t):(h(this,w)??p(this,w,{}),h(this,w)[e.toLowerCase()]=t),this.finalized&&(r!=null&&r.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});d(this,"status",e=>{p(this,$,!1),p(this,I,e)});d(this,"set",(e,t)=>{h(this,D)??p(this,D,{}),h(this,D)[e]=t});d(this,"get",e=>h(this,D)?h(this,D)[e]:void 0);d(this,"newResponse",(e,t,r)=>{if(h(this,$)&&!r&&!t&&h(this,I)===200)return new Response(e,{headers:h(this,w)});if(t&&typeof t!="number"){const n=new Headers(t.headers);h(this,g)&&h(this,g).forEach((a,c)=>{c==="set-cookie"?n.append(c,a):n.set(c,a)});const i=ne(n,h(this,w));return new Response(e,{headers:i,status:t.status??h(this,I)})}const s=typeof t=="number"?t:h(this,I);h(this,w)??p(this,w,{}),h(this,g)??p(this,g,new Headers),ne(h(this,g),h(this,w)),h(this,O)&&(h(this,O).headers.forEach((n,i)=>{var a,c;i==="set-cookie"?(a=h(this,g))==null||a.append(i,n):(c=h(this,g))==null||c.set(i,n)}),ne(h(this,g),h(this,w))),r??(r={});for(const[n,i]of Object.entries(r))if(typeof i=="string")h(this,g).set(n,i);else{h(this,g).delete(n);for(const a of i)h(this,g).append(n,a)}return new Response(e,{status:s,headers:h(this,g)})});d(this,"body",(e,t,r)=>typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t));d(this,"text",(e,t,r)=>{if(!h(this,w)){if(h(this,$)&&!r&&!t)return new Response(e);p(this,w,{})}return h(this,w)["content-type"]=Xe,typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t)});d(this,"json",(e,t,r)=>{const s=JSON.stringify(e);return h(this,w)??p(this,w,{}),h(this,w)["content-type"]="application/json; charset=UTF-8",typeof t=="number"?this.newResponse(s,t,r):this.newResponse(s,t)});d(this,"html",(e,t,r)=>(h(this,w)??p(this,w,{}),h(this,w)["content-type"]="text/html; charset=UTF-8",typeof e=="object"&&(e instanceof Promise||(e=e.toString()),e instanceof Promise)?e.then(s=>Oe(s,Ge.Stringify,!1,{})).then(s=>typeof t=="number"?this.newResponse(s,t,r):this.newResponse(s,t)):typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t)));d(this,"redirect",(e,t)=>(h(this,g)??p(this,g,new Headers),h(this,g).set("Location",e),this.newResponse(null,t??302)));d(this,"notFound",()=>(h(this,M)??p(this,M,()=>new Response),h(this,M).call(this,this)));p(this,q,e),t&&(p(this,A,t.executionCtx),this.env=t.env,p(this,M,t.notFoundHandler),p(this,X,t.path),p(this,G,t.matchResult))}get req(){return h(this,K)??p(this,K,new Ee(h(this,q),h(this,X),h(this,G))),h(this,K)}get event(){if(h(this,A)&&"respondWith"in h(this,A))return h(this,A);throw Error("This context has no FetchEvent")}get executionCtx(){if(h(this,A))return h(this,A);throw Error("This context has no ExecutionContext")}get res(){return p(this,$,!1),h(this,O)||p(this,O,new Response("404 Not Found",{status:404}))}set res(e){if(p(this,$,!1),h(this,O)&&e){h(this,O).headers.delete("content-type");for(const[t,r]of h(this,O).headers.entries())if(t==="set-cookie"){const s=h(this,O).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}p(this,O,e),this.finalized=!0}get var(){return{...h(this,D)}}},q=new WeakMap,K=new WeakMap,D=new WeakMap,I=new WeakMap,A=new WeakMap,g=new WeakMap,w=new WeakMap,O=new WeakMap,$=new WeakMap,z=new WeakMap,N=new WeakMap,M=new WeakMap,G=new WeakMap,X=new WeakMap,we),fe=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(c){if(c<=i)throw new Error("next() called multiple times");i=c;let o,l=!1,u;if(e[c]?(u=e[c][0][0],s instanceof Z&&(s.req.routeIndex=c)):u=c===e.length&&n||void 0,!u)s instanceof Z&&s.finalized===!1&&r&&(o=await r(s));else try{o=await u(s,()=>a(c+1))}catch(f){if(f instanceof Error&&s instanceof Z&&t)s.error=f,o=await t(f,s),l=!0;else throw f}return o&&(s.finalized===!1||l)&&(s.res=o),s}},y="ALL",Qe="all",Ye=["get","post","put","delete","options","patch"],je="Can not add a route since the matcher is already built.",Pe=class extends Error{},Je=Symbol("composedHandler"),Ze=e=>e.text("404 Not Found",404),pe=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),j,Re,Se=(Re=class{constructor(t={}){d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");b(this,j,"/");d(this,"routes",[]);d(this,"notFoundHandler",Ze);d(this,"errorHandler",pe);d(this,"onError",t=>(this.errorHandler=t,this));d(this,"notFound",t=>(this.notFoundHandler=t,this));d(this,"fetch",(t,...r)=>this.dispatch(t,r[1],r[0],t.method));d(this,"request",(t,r,s,n)=>{if(t instanceof Request)return r!==void 0&&(t=new Request(t,r)),this.fetch(t,s,n);t=t.toString();const i=/^https?:\/\//.test(t)?t:`http://localhost${k("/",t)}`,a=new Request(i,r);return this.fetch(a,s,n)});d(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(this.dispatch(t.request,t,void 0,t.request.method))})});[...Ye,Qe].forEach(n=>{this[n]=(i,...a)=>(typeof i=="string"?p(this,j,i):this.addRoute(n,h(this,j),i),a.forEach(c=>{typeof c!="string"&&this.addRoute(n,h(this,j),c)}),this)}),this.on=(n,i,...a)=>{for(const c of[i].flat()){p(this,j,c);for(const o of[n].flat())a.map(l=>{this.addRoute(o.toUpperCase(),h(this,j),l)})}return this},this.use=(n,...i)=>(typeof n=="string"?p(this,j,n):(p(this,j,"*"),i.unshift(n)),i.forEach(a=>{this.addRoute(y,h(this,j),a)}),this);const s=t.strict??!0;delete t.strict,Object.assign(this,t),this.getPath=s?t.getPath??be:qe}clone(){const t=new Se({router:this.router,getPath:this.getPath});return t.routes=this.routes,t}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{let i;r.errorHandler===pe?i=n.handler:(i=async(a,c)=>(await fe([],r.errorHandler)(a,()=>n.handler(a,c))).res,i[Je]=n.handler),s.addRoute(n.method,n.path,i)}),this}basePath(t){const r=this.clone();return r._basePath=k(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,n=s.replaceRequest));const a=i?o=>{const l=i(o);return Array.isArray(l)?l:[l]}:o=>{let l;try{l=o.executionCtx}catch{}return[o.env,l]};n||(n=(()=>{const o=k(this._basePath,t),l=o==="/"?0:o.length;return u=>{const f=new URL(u.url);return f.pathname=f.pathname.slice(l)||"/",new Request(f,u)}})());const c=async(o,l)=>{const u=await r(n(o.req.raw),...a(o));if(u)return u;await l()};return this.addRoute(y,k(t,"*"),c),this}addRoute(t,r,s){t=t.toUpperCase(),r=k(this._basePath,r);const n={path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)}matchRoute(t,r){return this.router.match(t,r)}handleError(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t}dispatch(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await this.dispatch(t,r,s,"GET")))();const i=this.getPath(t,{env:s}),a=this.matchRoute(n,i),c=new Z(t,{path:i,matchResult:a,env:s,executionCtx:r,notFoundHandler:this.notFoundHandler});if(a[0].length===1){let l;try{l=a[0][0][0][0](c,async()=>{c.res=await this.notFoundHandler(c)})}catch(u){return this.handleError(u,c)}return l instanceof Promise?l.then(u=>u||(c.finalized?c.res:this.notFoundHandler(c))).catch(u=>this.handleError(u,c)):l??this.notFoundHandler(c)}const o=fe(a[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{const l=await o(c);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return this.handleError(l,c)}})()}},j=new WeakMap,Re),te="[^/]+",W=".*",V="(?:|/.*)",U=Symbol(),et=new Set(".\\+*[^]$()");function tt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===W||e===V?1:t===W||t===V?-1:e===te?1:t===te?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var oe=class{constructor(){d(this,"index");d(this,"varIndex");d(this,"children",Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(this.index!==void 0)throw U;if(i)return;this.index=r;return}const[a,...c]=t,o=a==="*"?c.length===0?["","",W]:["","",te]:a==="/*"?["","",V]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(o){const u=o[1];let f=o[2]||te;if(u&&o[2]&&(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f)))throw U;if(l=this.children[f],!l){if(Object.keys(this.children).some(R=>R!==W&&R!==V))throw U;if(i)return;l=this.children[f]=new oe,u!==""&&(l.varIndex=n.varIndex++)}!i&&u!==""&&s.push([u,l.varIndex])}else if(l=this.children[a],!l){if(Object.keys(this.children).some(u=>u.length>1&&u!==W&&u!==V))throw U;if(i)return;l=this.children[a]=new oe}l.insert(c,r,s,n,i)}buildRegExpStr(){const r=Object.keys(this.children).sort(tt).map(s=>{const n=this.children[s];return(typeof n.varIndex=="number"?`(${s})@${n.varIndex}`:et.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof this.index=="number"&&r.unshift(`#${this.index}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},rt=class{constructor(){d(this,"context",{varIndex:0});d(this,"root",new oe)}insert(e,t,r){const s=[],n=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const l=`@\\${a}`;return n[a]=[l,o],a++,c=!0,l}),!c)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[c]=n[a];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(c)!==-1){i[o]=i[o].replace(c,n[a][1]);break}}return this.root.insert(i,t,s,this.context,r),s}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>typeof i<"u"?(r[++t]=Number(i),"$()"):(typeof a<"u"&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},He=[],st=[/^$/,[],Object.create(null)],ee=Object.create(null);function Ae(e){return ee[e]??(ee[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function nt(){ee=Object.create(null)}function it(e){var l;const t=new rt,r=[];if(e.length===0)return st;const s=e.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,f],[R,S])=>u?1:R?-1:f.length-S.length),n=Object.create(null);for(let u=0,f=-1,R=s.length;u<R;u++){const[S,m,v]=s[u];S?n[m]=[v.map(([P])=>[P,Object.create(null)]),He]:f++;let x;try{x=t.insert(m,f,S)}catch(P){throw P===U?new Pe(m):P}S||(r[f]=v.map(([P,F])=>{const H=Object.create(null);for(F-=1;F>=0;F--){const[Q,Y]=x[F];H[Q]=Y}return[P,H]}))}const[i,a,c]=t.buildRegExp();for(let u=0,f=r.length;u<f;u++)for(let R=0,S=r[u].length;R<S;R++){const m=(l=r[u][R])==null?void 0:l[1];if(!m)continue;const v=Object.keys(m);for(let x=0,P=v.length;x<P;x++)m[v[x]]=c[m[v[x]]]}const o=[];for(const u in a)o[u]=r[a[u]];return[i,o,n]}function C(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Ae(r).test(t))return[...e[r]]}}var ot=class{constructor(){d(this,"name","RegExpRouter");d(this,"middleware");d(this,"routes");this.middleware={[y]:Object.create(null)},this.routes={[y]:Object.create(null)}}add(e,t,r){var c;const{middleware:s,routes:n}=this;if(!s||!n)throw new Error(je);s[e]||[s,n].forEach(o=>{o[e]=Object.create(null),Object.keys(o[y]).forEach(l=>{o[e][l]=[...o[y][l]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=Ae(t);e===y?Object.keys(s).forEach(l=>{var u;(u=s[l])[t]||(u[t]=C(s[l],t)||C(s[y],t)||[])}):(c=s[e])[t]||(c[t]=C(s[e],t)||C(s[y],t)||[]),Object.keys(s).forEach(l=>{(e===y||e===l)&&Object.keys(s[l]).forEach(u=>{o.test(u)&&s[l][u].push([r,i])})}),Object.keys(n).forEach(l=>{(e===y||e===l)&&Object.keys(n[l]).forEach(u=>o.test(u)&&n[l][u].push([r,i]))});return}const a=ve(t)||[t];for(let o=0,l=a.length;o<l;o++){const u=a[o];Object.keys(n).forEach(f=>{var R;(e===y||e===f)&&((R=n[f])[u]||(R[u]=[...C(s[f],u)||C(s[y],u)||[]]),n[f][u].push([r,i-l+o+1]))})}}match(e,t){nt();const r=this.buildAllMatchers();return this.match=(s,n)=>{const i=r[s]||r[y],a=i[2][n];if(a)return a;const c=n.match(i[0]);if(!c)return[[],He];const o=c.indexOf("",1);return[i[1][o],c]},this.match(e,t)}buildAllMatchers(){const e=Object.create(null);return[...Object.keys(this.routes),...Object.keys(this.middleware)].forEach(t=>{e[t]||(e[t]=this.buildMatcher(t))}),this.middleware=this.routes=void 0,e}buildMatcher(e){const t=[];let r=e===y;return[this.middleware,this.routes].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==y&&t.push(...Object.keys(s[y]).map(i=>[i,s[y][i]]))}),r?it(t):null}},at=class{constructor(e){d(this,"name","SmartRouter");d(this,"routers",[]);d(this,"routes",[]);Object.assign(this,e)}add(e,t,r){if(!this.routes)throw new Error(je);this.routes.push([e,t,r])}match(e,t){if(!this.routes)throw new Error("Fatal error");const{routers:r,routes:s}=this,n=r.length;let i=0,a;for(;i<n;i++){const c=r[i];try{s.forEach(o=>{c.add(...o)}),a=c.match(e,t)}catch(o){if(o instanceof Pe)continue;throw o}this.match=c.match.bind(c),this.routers=[c],this.routes=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}},$e=class{constructor(e,t,r){d(this,"methods");d(this,"children");d(this,"patterns");d(this,"order",0);d(this,"name");d(this,"params",Object.create(null));if(this.children=r||Object.create(null),this.methods=[],this.name="",e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0,name:this.name},this.methods=[s]}this.patterns=[]}insert(e,t,r){this.name=`${e} ${t}`,this.order=++this.order;let s=this;const n=ke(t),i=[];for(let o=0,l=n.length;o<l;o++){const u=n[o];if(Object.keys(s.children).includes(u)){s=s.children[u];const R=de(u);R&&i.push(R[1]);continue}s.children[u]=new $e;const f=de(u);f&&(s.patterns.push(f),i.push(f[1])),s=s.children[u]}s.methods.length||(s.methods=[]);const a=Object.create(null),c={handler:r,possibleKeys:i.filter((o,l,u)=>u.indexOf(o)===l),name:this.name,score:this.order};return a[e]=c,s.methods.push(a),s}gHSets(e,t,r,s){const n=[];for(let i=0,a=e.methods.length;i<a;i++){const c=e.methods[i],o=c[t]||c[y],l=Object.create(null);o!==void 0&&(o.params=Object.create(null),o.possibleKeys.forEach(u=>{const f=l[o.name];o.params[u]=s[u]&&!f?s[u]:r[u]??s[u],l[o.name]=!0}),n.push(o))}return n}search(e,t){const r=[];this.params=Object.create(null);let n=[this];const i=ye(t);for(let c=0,o=i.length;c<o;c++){const l=i[c],u=c===o-1,f=[];for(let R=0,S=n.length;R<S;R++){const m=n[R],v=m.children[l];v&&(v.params=m.params,u===!0?(v.children["*"]&&r.push(...this.gHSets(v.children["*"],e,m.params,Object.create(null))),r.push(...this.gHSets(v,e,m.params,Object.create(null)))):f.push(v));for(let x=0,P=m.patterns.length;x<P;x++){const F=m.patterns[x],H={...m.params};if(F==="*"){const re=m.children["*"];re&&(r.push(...this.gHSets(re,e,m.params,Object.create(null))),f.push(re));continue}if(l==="")continue;const[Q,Y,B]=F,L=m.children[Q],ce=i.slice(c).join("/");if(B instanceof RegExp&&B.test(ce)){H[Y]=ce,r.push(...this.gHSets(L,e,m.params,H));continue}(B===!0||B instanceof RegExp&&B.test(l))&&typeof Q=="string"&&(H[Y]=l,u===!0?(r.push(...this.gHSets(L,e,H,m.params)),L.children["*"]&&r.push(...this.gHSets(L.children["*"],e,H,m.params))):(L.params=H,f.push(L)))}}n=f}return[r.sort((c,o)=>c.score-o.score).map(({handler:c,params:o})=>[c,o])]}},ct=class{constructor(){d(this,"name","TrieRouter");d(this,"node");this.node=new $e}add(e,t,r){const s=ve(t);if(s){for(const n of s)this.node.insert(e,n,r);return}this.node.insert(e,t,r)}match(e,t){return this.node.search(e,t)}},De=class extends Se{constructor(e={}){super(e),this.router=e.router??new at({routers:[new ot,new ct]})}};const ae=new De;ae.get("/api/clock",e=>e.json({var:e.env.MY_VAR,time:new Date().toLocaleTimeString()}));ae.get("*",e=>e.html(_e(ue("html",{children:[ue("head",{children:[_("meta",{charSet:"utf-8"}),_("meta",{content:"width=device-width, initial-scale=1",name:"viewport"}),_("link",{rel:"stylesheet",href:"https://cdn.simplecss.org/simple.min.css"}),_("script",{type:"module",src:"/static/client.js"})]}),_("body",{children:_("div",{id:"root"})})]}))));const ge=new De,ht=Object.assign({"/src/index.tsx":ae});let Fe=!1;for(const[,e]of Object.entries(ht))e&&(ge.route("/",e),ge.notFound(e.notFoundHandler),Fe=!0);if(!Fe)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{ge as default};
